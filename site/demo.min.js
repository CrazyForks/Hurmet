const autoCorrectRegEx=/([?:<>\-~/_]=| \.| \*|~~|\+-|-\+|<-->|<->|<>|<--|<-|-->|->|-:|\^\^|\\\||\/\/\/|\b(bar|hat|vec|tilde|dot|ddot|ul)|\b(bb|bbb|cc|ff|ss) [A-Za-z]|\\?[A-Za-z]{2,}|\\c|\\ |\\o|root [234]|<<|>>|\^-?[0-9]+|\|\|\||\/_|''|""|00)\s$/;const accents={acute:"́",bar:"̅",breve:"̆",check:"̌",dot:"̇",ddot:"̈",grave:"̀",hat:"̂",harpoon:"⃑",leftharpoon:"⃐",leftrightvec:"⃡",leftvec:"⃖",ring:"̊",tilde:"̃",vec:"⃗",ul:"̲"};const autoCorrections={alpha:"α",beta:"β",chi:"χ",delta:"δ",Delta:"Δ",epsilon:"ε",varepsilon:"ɛ",eta:"η",gamma:"γ",Gamma:"Γ",iota:"ι",kappa:"κ",lambda:"λ",Lambda:"Λ",mu:"μ",nu:"ν",omega:"ω",Omega:"Ω",phi:"ϕ",varphi:"φ",Phi:"Φ",pi:"π",Pi:"Π",psi:"ψ",Psi:"Ψ",rho:"ρ",sigma:"σ",Sigma:"Σ",tau:"τ",theta:"θ",vartheta:"ϑ",Theta:"Θ",upsilon:"υ",xi:"ξ",Xi:"Ξ",zeta:"ζ",prime:"ʹ",ee:"ε",ll:"λ",sqrt:"√","root 2":"√","root 3":"∛","root 4":"∜",AA:"∀",CC:"ℂ",EE:"∃",HH:"ℍ",NN:"ℕ",QQ:"ℚ",RR:"ℝ",ZZ:"ℤ",OO:"𝒪",ii:"√(-1)",oo:"∞",ooo:"°",not:"¬","-:":"÷","\\ ":"˽","\\c":"¢","\\cdots":"⋯","\\vdots":"⋮","\\ddots":"⋱","\\floor":"⎿⏌","\\ceil":"⎾⏋",xx:"×","\\int":"∫","\\iint":"∬","\\oint":"∮","\\sum":"∑",nn:"∩",nnn:"⋂",uu:"∪",uuu:"⋃","\\del":"∂","\\grad":"∇","\\hbar":"ℏ","\\ell":"ℓ","\\nabla":"∇","\\alef":"ℵ","\\subset":"⊂","\\supset":"⊃",contains:"⊃",owns:"∋","\\subseteq":"⊆","\\nsubset":"⊄","\\nsubseteq":"⊈","\\nsupset":"⊅","\\nsupseteq":"⊉","\\forall":"∀","\\therefore":"∴","\\mapsto":"↦","\\checkmark":"✓",bar:"ˉ",dot:"˙",ddot:"¨",hat:"ˆ",tilde:"˜",vec:" ⃗","\\land":"∧","\\lor":"∨","\\not":"¬","\\notin":"∉","\\euro":"€","\\pound":"£","\\yen":"¥","\\o":"ø","^^":"∧",vv:"∨",vvv:"⋁","\\xor":"⊻","\\in":"∈","<>":"≠",":=":"≔","?=":"≟","<=":"≤",">=":"≥","-=":"≡","~=":"≅","_=":"≡","~~":"≈","+-":"±","-+":"∓","<<":"⟨",">>":"⟩","///":"∕","<->":"↔","<-":"←","<--":"⟵","--\x3e":"⟶","->":"→","<--\x3e":"\\xrightleftarrows","\\circ":"∘","\\otimes":"⊗","|||":"¦","\\|":"‖","/_":"∠"," .":"·"," *":" ∗ ","''":"′",'""':"″"};const supCharFromNum={"^":"","-":"⁻",2:"²",3:"³",1:"¹",0:"⁰",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","(":"",")":""};const superscript=e=>{let t="";for(const n of e){t+=supCharFromNum[n]}return t};const lowSurrogateDiff={bb:[56255,56249],bbb:[56567,56561],cc:[56411,56405],ff:[56671,56665]};const wideExceptions=[56634,56639,56645,56647,56648,56649,56657,56477,56480,56481,56483,56484,56487,56488,56493,56506,56508,56513,56516];const bbb={C:"ℂ",H:"ℍ",N:"ℕ",P:"ℙ",Q:"ℚ",R:"ℝ",Z:"ℤ"};const calligraphic={B:"ℬ",E:"ℰ",F:"ℱ",H:"ℋ",I:"ℐ",L:"ℒ",M:"ℳ",R:"ℛ",e:"ℯ",g:"ℊ",l:"ℓ",o:"ℴ"};const accentedChar=e=>{const t=e.indexOf(" ");const n=e.substring(t+1);const r=e.substring(0,t);switch(r){case"bb":case"bbb":case"cc":case"ff":{const e=n.charCodeAt(0);let t="";if(e<65||e>122){return null}const o=e<91?0:1;if(r==="cc"&&o&&e!==108){return null}if(e>90&&r==="bbb"){return null}const s=e+lowSurrogateDiff[r][o];if(wideExceptions.includes(s)){t=r==="bbb"?bbb[n]:calligraphic[n]}else{t="\ud835"+String.fromCharCode(s)}return t}default:return null}};const autoCorrect=(e,t,n)=>{if(t.length>0&&t.slice(-1)===" "){const r=autoCorrectRegEx.exec(t);if(r){const o=r[0].slice(0,-1);let s;const a=accents[o];if(a){const o=t.slice(0,-(r[0].length+1))+a;e.updateCode(o+n);const s=o.length;e.restore({start:s,end:s,dir:undefined})}else{s=autoCorrections[o];if(!s){if(o.charAt(0)==="^"){s=superscript(o)}else{if(o.indexOf(" ")>0){s=accentedChar(o)}}}}if(s){const o=t.slice(0,-r[0].length)+s;e.updateCode(o+n);const a=o.length;e.restore({start:a,end:a,dir:undefined})}}}};const renderSVG=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");Object.keys(e.attrs).forEach((n=>{if(n==="float"){t.style.float=e.attrs.float}else{t.setAttribute(n,e.attrs[n])}}));e.children.forEach((e=>{const n=document.createElementNS("http://www.w3.org/2000/svg",e.tag);Object.keys(e.attrs).forEach((t=>{n.setAttribute(t,e.attrs[t]);if(t==="title"){n.appendChild(document.createTextNode(e.attrs["text"]))}else{n.setAttribute(t,e.attrs[t])}}));if(e.tag==="text"){e.children.forEach((e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(e.attrs){Object.keys(e.attrs).forEach((n=>{t.setAttribute(n,e.attrs[n])}))}t.appendChild(document.createTextNode(e.text));n.appendChild(t)}))}else if(e.tag==="defs"){const t=document.createElementNS("http://www.w3.org/2000/svg","style");t.appendChild(document.createTextNode(e.style));n.appendChild(t)}t.appendChild(n)}));return t};const allZeros=Object.freeze([0,0,0,0,0,0,0,0]);const dt=Object.freeze({NULL:0,RATIONAL:1,COMPLEX:2,BOOLEAN:4,FROMCOMPARISON:8,BOOLEANFROMCOMPARISON:12,STRING:16,QUANTITY:32,DATE:64,RANGE:128,TUPLE:256,MAP:512,ROWVECTOR:1024,COLUMNVECTOR:2048,MATRIX:4096,DATAFRAME:8192,MODULE:16384,ERROR:32768,UNIT:65536,DRAWING:131072,RICHTEXT:262144,DICTIONARY:524288});const codeJar=(e,t)=>{const n={tab:"\t",indentOn:/{$/,catchTab:true,preserveIdent:true,addClosing:true};const r=window.document;const o=[];let s;e.setAttribute("contenteditable","plaintext-only");e.setAttribute("spellcheck","false");e.style.outline="none";e.style.overflowWrap="break-word";e.style.overflowY="auto";e.style.whiteSpace="pre-wrap";let a=false;if(e.contentEditable!=="plaintext-only")a=true;if(a)e.setAttribute("contenteditable","true");const c=(t,n)=>{o.push([t,n]);e.addEventListener(t,n)};c("keydown",(r=>{if(t&&r.keyCode===13&&!r.shiftKey)return;if(r.keyCode===65&&r.ctrlKey){window.getSelection().selectAllChildren(e);r.preventDefault()}if(r.defaultPrevented)return;if(n.preserveIdent)f(r);else m(r);if(n.catchTab)h(r);if(n.addClosing)b(r);if(a)d(i())}));c("keyup",(e=>{if(e.defaultPrevented)return;if(e.isComposing)return;if(s)s(y())}));c("paste",(e=>{g(e);if(s)s(y())}));function i(){const t=x();const n={start:0,end:0,dir:undefined};let{anchorNode:o,anchorOffset:s,focusNode:a,focusOffset:c}=t;if(!o||!a)throw"error1";if(o.nodeType===Node.ELEMENT_NODE){const e=r.createTextNode("");o.insertBefore(e,o.childNodes[s]);o=e;s=0}if(a.nodeType===Node.ELEMENT_NODE){const e=r.createTextNode("");a.insertBefore(e,a.childNodes[c]);a=e;c=0}p(e,(e=>{if(e===o&&e===a){n.start+=s;n.end+=c;n.dir=s<=c?"->":"<-";return"stop"}if(e===o){n.start+=s;if(!n.dir){n.dir="->"}else{return"stop"}}else if(e===a){n.end+=c;if(!n.dir){n.dir="<-"}else{return"stop"}}if(e.nodeType===Node.TEXT_NODE){if(n.dir!="->")n.start+=e.nodeValue.length;if(n.dir!="<-")n.end+=e.nodeValue.length}}));e.normalize();return n}function d(t){const n=x();let r,o=0;let s,a=0;if(!t.dir)t.dir="->";if(t.start<0)t.start=0;if(t.end<0)t.end=0;if(t.dir=="<-"){const{start:e,end:n}=t;t.start=n;t.end=e}let c=0;p(e,(e=>{if(e.nodeType!==Node.TEXT_NODE)return;const n=(e.nodeValue||"").length;if(c+n>t.start){if(!r){r=e;o=t.start-c}if(c+n>t.end){s=e;a=t.end-c;return"stop"}}c+=n}));if(!r)r=e,o=e.childNodes.length;if(!s)s=e,a=e.childNodes.length;if(t.dir=="<-"){[r,o,s,a]=[s,a,r,o]}n.setBaseAndExtent(r,o,s,a)}function l(){const t=x();const n=t.getRangeAt(0);const o=r.createRange();o.selectNodeContents(e);o.setEnd(n.startContainer,n.startOffset);return o.toString()}function u(){const t=x();const n=t.getRangeAt(0);const o=r.createRange();o.selectNodeContents(e);o.setStart(n.endContainer,n.endOffset);return o.toString()}function f(e){if(e.key==="Enter"){const t=l();const r=u();let[o]=E(t);let s=o;if(n.indentOn.test(t)){s+=n.tab}if(s.length>0){C(e);e.stopPropagation();v("\n"+s)}else{m(e)}if(s!==o&&r[0]==="}"){const e=i();v("\n"+o);d(e)}}}function m(e){if(a&&e.key==="Enter"){C(e);e.stopPropagation();if(u()==""){v("\n ");const e=i();e.start=--e.end;d(e)}else{v("\n")}}}function b(e){const t=`([{'"`;const n=`)]}'"`;const r=u();const o=l();const s=o.substr(o.length-1)==="\\";const a=r.substr(0,1);if(n.includes(e.key)&&!s&&a===e.key){const t=i();C(e);t.start=++t.end;d(t)}else if(t.includes(e.key)&&!s&&(`"'`.includes(e.key)||[""," ","\n"].includes(a))){C(e);const r=i();const o=r.start==r.end?"":x().toString();const s=e.key+o+n[t.indexOf(e.key)];v(s);r.start++;r.end++;d(r)}}function h(e){if(e.key==="Tab"){C(e);if(e.shiftKey){const e=l();let[t,o]=E(e);if(t.length>0){const e=i();const s=Math.min(n.tab.length,t.length);d({start:o,end:o+s});r.execCommand("delete");e.start-=s;e.end-=s;d(e)}}else{v(n.tab)}}}function g(e){C(e);const t=(e.originalEvent||e).clipboardData.getData("text/plain").replace(/\r/g,"");const n=i();v(t);d({start:n.start+t.length,end:n.start+t.length})}function p(e,t){const n=[];if(e.firstChild)n.push(e.firstChild);let r=n.pop();while(r){if(t(r)==="stop")break;if(r.nextSibling)n.push(r.nextSibling);if(r.firstChild)n.push(r.firstChild);r=n.pop()}}function v(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");r.execCommand("insertHTML",false,e)}function E(e){let t=e.length-1;while(t>=0&&e[t]!=="\n")t--;t++;let n=t;while(n<e.length&&/[ \t]/.test(e[n]))n++;return[e.substring(t,n)||"",t,n]}function y(){return e.textContent||""}function C(e){e.preventDefault()}function x(){if(e.parentNode&&e.parentNode.nodeType==Node.DOCUMENT_FRAGMENT_NODE){return e.parentNode.getSelection()}return window.getSelection()}return{updateOptions(e){Object.assign(n,e)},updateCode(t){e.textContent=t},onUpdate(e){s=e},toString:y,save:i,restore:d,destroy(){for(let[t,n]of o){e.removeEventListener(t,n)}}}};function selectedText(){const e=window.getSelection();if(e.rangeCount===0)return"";return e.getRangeAt(0).toString()}function textBeforeCursor(e){const t=window.getSelection();if(t.rangeCount===0)return"";const n=t.getRangeAt(0);const r=document.createRange();r.selectNodeContents(e);r.setEnd(n.startContainer,n.startOffset);return r.toString()}function textAfterCursor(e){const t=window.getSelection();if(t.rangeCount===0)return"";const n=t.getRangeAt(0);const r=document.createRange();r.selectNodeContents(e);r.setStart(n.endContainer,n.endOffset);return r.toString()}const hurmetVars=Object.create(null);hurmet.calculate(`x = 5`,hurmetVars);hurmet.calculate(`w = 100 'lbf/ft'`,hurmetVars);hurmet.calculate(`L = 3.1 'm'`,hurmetVars);hurmet.calculate(`name = "James"`,hurmetVars);hurmet.calculate(`s = "abcde"`,hurmetVars);hurmet.calculate(`𝐕 = [1, 2, 3, 4, 5]`,hurmetVars);hurmet.calculate(`𝐌 = (1, 2, 3; 4, 5, 6; 7, 8, 9)`,hurmetVars);const df="``"+`name,w,area\n,in,in²\nA,4,10\nB,6,22`+"``";hurmet.calculate(`DF =`+df,hurmetVars);hurmet.calculate(`A = 8`,hurmetVars);const wideFlanges="``"+`name|weight|A|d|bf|tw|Ix|Sx|rx\n|lbf/ft|in^2|in|in|in|in^4|in^3|in\nW14X90|90|26.5|14|14.5|0.44|999|143|6.14\nW12X65|65|19.1|12.1|12|0.39|533|87.9|5.28\nW10X49|49|14.4|10|10|0.34|272|54.6|4.35\nW8X31|31|9.13|8|8|0.285|110|27.5|3.47\nW8X18|18|5.26|8.14|5.25|0.23|61.9|15.2|3.43\nW6X15|15|4.43|5.99|5.99|0.23|29.1|9.72|2.56\nW4X13|13|3.83|4.16|4.06|0.28|11.3|5.46|1.72`+"``";hurmet.calculate(`wideFlanges =`+wideFlanges,hurmetVars);const dict=`{"#4": 0.22, "#5": 0.31} 'in2'`;hurmet.calculate(`barArea =`+dict,hurmetVars);const module="E = 29000 'ksi'\n\nv = [4, 6, 8]\n\nfunction multiply(a, b)\n  return a × b\nend";hurmetVars["mod"]=hurmet.scanModule(module,"1,000,000.");const renderMath=(e,t)=>{let n=e.toString();const r=selectedText();if(r.length===0){autoCorrect(e,textBeforeCursor(editor),textAfterCursor(editor))}n=e.toString();const o=document.getElementById("formatBox").value.trim();hurmetVars.format={value:o};const s=hurmet.calculate(n,hurmetVars);try{if(typeof s==="object"&&s.dtype&&s.dtype===dt.DRAWING){t.appendChild(renderSVG(s.resultdisplay))}else{hurmet.render(s,t,{trust:e=>e.command==="\\class"&&e.class==="special-fraction",wrap:"="})}}catch(e){while(t.lastChild){t.removeChild(t.lastChild)}const n=document.createTextNode(e.message);const r=document.createElement("span");r.appendChild(n);t.appendChild(r);r.setAttribute("class","errorMessage")}};const prompts={"statement-container":"2 + 2 = ?","arithmetic-container":"2 × 4 + 3^2/7 = ?","variable-container":"b = 2 L = ?","greek-container":"theta + x dot + f''","q-container":"2 × 3.1 'm' = ?? ft",markup:"(a, b; c, d)","auto-correct":"theta hat <= bb M xx sqrt 3 . f''","display-selectors":"b = 2 L = ?? ft","accessor-container":"𝐕[2] = ?","calculation-forms":"x = 2 A = ?",identifiers:"f_c′ = 4500","identi-correct":"bb M != h_sub +  theta bar + f''","data-types":`"a string" ≠ 2.3`,number:"33 / 2.45 × 3.2% + 3 7/8 + 3.1e1 = ?","complex-number":"4∠30° = ??",unit:"9.807 'm/s²' = ?? ft/s²",matrix:"[2.1; -15.3]","matrix-mult":"[1, 2, 3] [3; 2; 1] = ?","data-frame":"wideFlanges.W10X49.A = ?? in2",dictionary:'A = barArea["#4"] = ?',functions:"sin(π/6) = ?","if-expressions":`x = {1 if 12 < 30; 0 otherwise} = ?`,"unit-aware-calculations":"4 'ft' + 3 'yards' = ?? m","remote-modules":"mod.E = ?? psi",tests:"@test 2 ≤ 3"};const editor=document.getElementById("demo-input");const jar=codeJar(editor,false);const demoOutput=document.getElementById("demo-output");editor.addEventListener("input",(e=>{renderMath(jar,demoOutput)}));jar.updateCode("Hi!");renderMath(jar,demoOutput);const formatOutput=document.getElementById("formatBox");formatOutput.addEventListener("input",(e=>{renderMath(jar,demoOutput)}));var observer=new IntersectionObserver((function(e){for(const t of e){if(t.intersectionRatio===1){jar.updateCode(prompts[t.target.id]);renderMath(jar,demoOutput);break}}}),{root:null,rootMargin:"0px",threshold:1});observer.observe(document.getElementById("statement-container"));observer.observe(document.getElementById("arithmetic-container"));observer.observe(document.getElementById("variable-container"));observer.observe(document.getElementById("greek-container"));observer.observe(document.getElementById("q-container"));observer.observe(document.getElementById("markup"));observer.observe(document.getElementById("auto-correct"));observer.observe(document.getElementById("display-selectors"));observer.observe(document.getElementById("accessor-container"));observer.observe(document.getElementById("calculation-forms"));observer.observe(document.getElementById("identifiers"));observer.observe(document.getElementById("identi-correct"));observer.observe(document.getElementById("data-types"));observer.observe(document.getElementById("number"));observer.observe(document.getElementById("complex-number"));observer.observe(document.getElementById("unit"));observer.observe(document.getElementById("matrix"));observer.observe(document.getElementById("matrix-mult"));observer.observe(document.getElementById("data-frame"));observer.observe(document.getElementById("functions"));observer.observe(document.getElementById("if-expressions"));observer.observe(document.getElementById("unit-aware-calculations"));observer.observe(document.getElementById("remote-modules"));observer.observe(document.getElementById("tests"));